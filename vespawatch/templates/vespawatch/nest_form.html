{% load i18n %}
{% load crispy_forms_tags %}
{% csrf_token %}

<vw-species-selector
    {% if form.instance.species %}
        :species-selected="{{ form.instance.species.pk }}"
    {% endif %}
    species-api-url="{% url 'vespawatch:api_species' %}"
    radio-name="species">
</vw-species-selector>

{% if object %}
    <vw-location-selector
        v-bind:init-coordinates="[{{ object.longitude }}, {{ object.latitude }}]"
        init-marker="true"
        location="{{ object.location }}">
    </vw-location-selector>
    <vw-datetime-selector
        :is-required="true"
        hidden-field-name="observation_time"
        init-date-time="{{ object.observation_time_iso }}">
    </vw-datetime-selector>
{% else %}
    <vw-location-selector
        {% if form.data %}
            v-bind:init-coordinates="[{{ form.data.longitude|default_if_none:4.5 }}, {{ form.data.latitude|default_if_none:50.7 }}]"
            init-marker="true"
        {% else %}
            v-bind:init-coordinates="[4.5, 50.7]"
            init-marker="false"
        {% endif %}
        location="{{ form.data.location|default_if_none:'' }}">
    </vw-location-selector>
    <vw-datetime-selector
        :is-required="true"
        hidden-field-name="observation_time"
        init-date-time="{{ form.data.observation_time|default_if_none:'' }}">
    </vw-datetime-selector>
{% endif %}

{{ form.comments|as_crispy_field }}
{{ form.redirect_to.as_hidden }}
{{ image_formset.management_form }}
{% for f in image_formset %}
    {{ f|crispy }}
{% endfor %}

{% if user.is_authenticated %}
    <h2>{% trans "Management action" %}</h2>
    {{ management_formset.management_form }}

    {% for f in management_formset %}
        {{ f|crispy }}
    {% endfor %}
{% else %}
    {{ form.observer_title|as_crispy_field }}
    {{ form.observer_last_name|as_crispy_field }}
    {{ form.observer_first_name|as_crispy_field }}
    {{ form.observer_email|as_crispy_field }}
    {{ form.observer_is_beekeeper|as_crispy_field }}
    <div class="form-group">
        <div class="form-check" id="div_id_terms_of_service">
            <input class="form-check-input" type="checkbox" id="id_terms_of_service">
            <label class="form-check-label" for="id_terms_of_service">
                {% trans "I accept the" %} <a href="#" data-toggle="modal" data-target="#TOSModal">{% trans "terms of service" %}</a>.
            </label>
        </div>
    </div>
    {% include 'vespawatch/terms_of_service_modal.html' %}
{% endif %}
